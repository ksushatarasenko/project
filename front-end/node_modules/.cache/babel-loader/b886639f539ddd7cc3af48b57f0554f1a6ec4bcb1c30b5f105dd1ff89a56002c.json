{"ast":null,"code":"import { makeAutoObservable } from \"mobx\";\nimport axios from \"axios\";\nclass CartStore {\n  constructor() {\n    this.items = [];\n    this.totalCount = 0;\n    this.isLoading = false;\n    this.amountPrice = 0;\n    makeAutoObservable(this);\n    this.loadLocalStorage();\n    this.placeOrder = this.placeOrder.bind(this);\n  }\n  addItem(product) {\n    const checkendItem = this.items.find(item => item.product.id === product.id);\n    checkendItem ? checkendItem.quantity += 1 : this.items.push({\n      product,\n      quantity: 1\n    });\n    this.calculateTotalCount();\n    this.saveLocalStorage();\n    this.amountOrderPrice();\n    this.isLoading = true;\n  }\n  removeItem(productId) {\n    const index = this.items.findIndex(item => item.product.id === productId);\n    if (index !== -1) {\n      this.items.splice(index, 1);\n    }\n    this.calculateTotalCount();\n    this.saveLocalStorage();\n    this.amountOrderPrice();\n  }\n  increment(productId) {\n    const index = this.items.findIndex(item => item.product.id === productId);\n    if (index !== -1) {\n      const item = this.items[index];\n      item.quantity += 1;\n    } else {\n      this.items.splice(index, 1);\n    }\n    this.calculateTotalCount();\n    this.saveLocalStorage();\n    this.amountOrderPrice();\n  }\n  decrement(productId) {\n    const index = this.items.findIndex(item => item.product.id === productId);\n    if (index !== -1 && this.items[index].quantity > 0) {\n      const item = this.items[index];\n      item.quantity -= 1;\n      this.calculateTotalCount();\n      this.saveLocalStorage();\n      this.amountOrderPrice();\n    } else if (this.items[index].quantity === 0) {\n      this.items.splice(index, 1);\n    } else {\n      this.items.splice(index, 1);\n    }\n  }\n  getSelectItems() {\n    return this.items;\n  }\n  amountOrderPrice() {\n    this.amountPrice = this.items.reduce((total, item) => total + item.product.price * item.quantity, 0);\n    this.amountPrice = this.amountPrice.toFixed(2);\n  }\n  calculateTotalCount() {\n    this.totalCount = this.items.reduce((total, item) => total + item.quantity, 0);\n  }\n  saveLocalStorage() {\n    localStorage.setItem('cart', JSON.stringify(this.items));\n  }\n  loadLocalStorage() {\n    this.isLoading = true;\n    const saveCart = localStorage.getItem('cart');\n    if (saveCart) {\n      this.items = JSON.parse(saveCart);\n      this.calculateTotalCount();\n      this.amountOrderPrice();\n    }\n    this.isLoading = false;\n  }\n  async placeOrder() {\n    this.isLoading = true;\n    try {\n      const response = await axios.post('http://localhost:3333/order/send', this.items);\n      this.orderInfo = response.data;\n      console.log(\"Успешный ответ от сервера:\", response.data);\n    } catch (error) {\n      console.error(\"Error placing order: \", error);\n      console.error(\"Ошибка при отправке POST запроса:\", error);\n    } finally {\n      this.isLoading = false;\n      localStorage.clear();\n      window.location.reload(); // для перезагрузки страницы\n      console.log(this.items);\n    }\n  }\n}\nconst cartStore = new CartStore();\nexport default cartStore;","map":{"version":3,"names":["makeAutoObservable","axios","CartStore","constructor","items","totalCount","isLoading","amountPrice","loadLocalStorage","placeOrder","bind","addItem","product","checkendItem","find","item","id","quantity","push","calculateTotalCount","saveLocalStorage","amountOrderPrice","removeItem","productId","index","findIndex","splice","increment","decrement","getSelectItems","reduce","total","price","toFixed","localStorage","setItem","JSON","stringify","saveCart","getItem","parse","response","post","orderInfo","data","console","log","error","clear","window","location","reload","cartStore"],"sources":["/Users/marinatarasenko/Documents/Frontend/project/front-end/src/store/cartStore/cartStore.js"],"sourcesContent":["import { makeAutoObservable } from \"mobx\";\nimport axios from \"axios\";\n\n\nclass CartStore {\n  items = [];\n  totalCount = 0;\n  isLoading = false;\n  amountPrice = 0;\n  \n\n  constructor() {\n    makeAutoObservable(this);\n    this.loadLocalStorage();\n    this.placeOrder = this.placeOrder.bind(this);\n  }\n\n  addItem(product) {\n    const checkendItem = this.items.find(item => item.product.id === product.id);\n    (checkendItem) ? (checkendItem.quantity +=1) : (this.items.push({product, quantity:1})); \n    this.calculateTotalCount();\n    this.saveLocalStorage();\n    this.amountOrderPrice();\n    this.isLoading = true;\n  }\n\n  removeItem(productId) {\n    const index = this.items.findIndex(item => item.product.id === productId);\n    if(index !== -1) {\n        this.items.splice(index,1);\n        }\n        this.calculateTotalCount();\n        this.saveLocalStorage();\n        this.amountOrderPrice();\n  }\n\n  increment(productId){\n    const index = this.items.findIndex(item => item.product.id === productId);\n    if(index !== -1){\n      const item = this.items[index];\n      item.quantity +=1;\n    } else {\n      this.items.splice(index,1);\n    }\n    this.calculateTotalCount();\n    this.saveLocalStorage();\n    this.amountOrderPrice();\n  }\n\n  decrement(productId){\n    const index = this.items.findIndex(item => item.product.id === productId);\n    if(index !== -1 && this.items[index].quantity > 0){\n      const item = this.items[index];\n      item.quantity -=1; \n      this.calculateTotalCount();\n      this.saveLocalStorage();\n      this.amountOrderPrice();     \n      } else if(this.items[index].quantity === 0){\n        this.items.splice(index,1);\n      } else {\n        this.items.splice(index, 1)\n      }\n  }\n\n  getSelectItems(){\n    return this.items;\n  }\n  \n  amountOrderPrice(){\n    this.amountPrice = this.items.reduce((total, item) => total + (item.product.price * item.quantity), 0);\n    this.amountPrice = this.amountPrice.toFixed(2);\n    \n  }\n  \n  calculateTotalCount() {\n    this.totalCount = this.items.reduce((total, item) => total + item.quantity, 0);\n  }\n  saveLocalStorage(){\n    localStorage.setItem('cart', JSON.stringify(this.items));\n  }\n\n loadLocalStorage(){\n    this.isLoading = true;   \n    const saveCart =localStorage.getItem('cart');     \n    if(saveCart){\n      this.items = JSON.parse(saveCart);\n      this.calculateTotalCount();\n      this.amountOrderPrice();     \n    }\n      this.isLoading = false;\n    } \n\n   async placeOrder () {    \n    this.isLoading = true;\n    \n   try {\n      const response = await axios.post('http://localhost:3333/order/send', this.items);\n      this.orderInfo = response.data;\n      console.log(\"Успешный ответ от сервера:\", response.data);\n      } catch (error) {\n        console.error(\"Error placing order: \", error);\n        console.error(\"Ошибка при отправке POST запроса:\", error);\n      } finally {\n          this.isLoading = false;\n          localStorage.clear();\n          window.location.reload();// для перезагрузки страницы\n          console.log(this.items)\n      }\n    }\n  }\n\n\nconst cartStore = new CartStore();\nexport default cartStore;\n\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}